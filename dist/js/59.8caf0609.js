"use strict";(self["webpackChunkproject_macaron"]=self["webpackChunkproject_macaron"]||[]).push([[59],{5059:function(e,t,l){l.r(t),l.d(t,{default:function(){return We}});var s=l(3396),o=l(7139);const a={class:"d-flex justify-content-between pt-4 py-3 pe-2"},i=(0,s._)("h2",{class:"m-0 text-secondary fw-bolder"},"產品列表",-1),r={class:"overflow-x-auto mb-3"},d={class:"table table-hover align-middle text-nowrap"},c=(0,s._)("thead",{class:"border-dark"},[(0,s._)("tr",null,[(0,s._)("th",{width:"150"},"類別"),(0,s._)("th",null,"產品名稱"),(0,s._)("th",{width:"150",class:"text-end"},"原價"),(0,s._)("th",{width:"150",class:"text-end"},"售價"),(0,s._)("th",{width:"100",class:"text-end"},"是否啟用"),(0,s._)("th",{width:"150",class:"text-center"},"編輯/刪除")])],-1),n={class:"text-end"},u={class:"text-end"},p={class:"text-center"},m={class:"btn-group btn-group-sm",role:"group","aria-label":"Basic example"},h=["onClick"],g=["onClick"];function _(e,t,l,_,b,f){const w=(0,s.up)("LoadingVue"),y=(0,s.up)("productModal"),v=(0,s.up)("deleteModal"),U=(0,s.up)("pagination");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(w,{active:b.isLoading,style:{"z-index":"1056"}},null,8,["active"]),(0,s.Wm)(y,{ref:"productModal","temp-product":b.temp,onUpdateProduct:f.updateProduct,onCreateProduct:f.createProduct},null,8,["temp-product","onUpdateProduct","onCreateProduct"]),(0,s.Wm)(v,{ref:"deleteModal","delete-item":b.deleteProduct,item:"產品",onDelete:f.deleteId},null,8,["delete-item","onDelete"]),(0,s._)("div",a,[i,(0,s._)("button",{type:"button",class:"btn btn-secondary align-self-center me-4",onClick:t[0]||(t[0]=e=>f.editProduct())}," 新增產品 ")]),(0,s._)("div",r,[(0,s._)("table",d,[c,(0,s._)("tbody",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(b.products,((t,l)=>((0,s.wg)(),(0,s.iD)("tr",{key:"product"+l},[(0,s._)("td",null,(0,o.zw)(t.category),1),(0,s._)("td",null,(0,o.zw)(t.title),1),(0,s._)("td",n,(0,o.zw)(e.$filters.currency(t.origin_price)),1),(0,s._)("td",u,(0,o.zw)(e.$filters.currency(t.price)),1),(0,s._)("td",{class:(0,o.C_)(["text-end text-muted",{"text-success":t.is_enabled}])},(0,o.zw)(t.is_enabled?"啟用":"未啟用"),3),(0,s._)("td",p,[(0,s._)("div",m,[(0,s._)("button",{type:"button",class:"btn btn-outline-success",onClick:e=>f.editProduct(t)}," 編輯 ",8,h),(0,s._)("button",{type:"button",class:"btn btn-outline-danger",onClick:e=>f.deleteConfirm(t)}," 刪除 ",8,g)])])])))),128))])])]),(0,s.Wm)(U,{"page-info":b.pageInfo,onSetPage:f.getData},null,8,["page-info","onSetPage"])],64)}l(560);var b=l(9242);const f={class:"modal fade",id:"productModal",tabindex:"-1",ref:"productModal"},w={class:"modal-dialog modal-xl modal-dialog-scrollable"},y={class:"modal-content"},v={class:"modal-header bg-secondary"},U={class:"modal-title fs-5 text-white"},x={class:"modal-body"},k={class:"row flex-column-reverse flex-md-row"},M={class:"col-lg-4"},$={class:"mb-3"},P=(0,s._)("p",{class:"mb-2 fw-semibold"},"產品主要圖片",-1),C={key:0},D=["src","alt"],L={class:"input-group mb-3"},F={key:1},V={class:"mb-3"},z=(0,s._)("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),I={class:"mb-3"},j=(0,s._)("label",{for:"imageFile",class:"form-label"},"上傳圖片",-1),q=(0,s._)("hr",null,null,-1),W={class:"mb-2 fw-semibold"},H={key:0},S=["src","alt"],Y={class:"input-group mb-3"},Z=["onClick"],E=["onUpdate:modelValue"],J=["onClick"],K={key:1},N={class:"mb-3"},O=["for"],B=["name","id","onUpdate:modelValue"],T={class:"mb-3"},A=["for"],G=["name","id","onChange"],Q={class:"mb-3"},R=["onClick"],X=(0,s._)("hr",null,null,-1),ee={key:0,class:"mb-3"},te={class:"col-lg-8"},le={class:"mb-3"},se=(0,s._)("label",{for:"title",class:"form-label fw-semibold"},"標題*",-1),oe={class:"mb-3"},ae={class:"row"},ie={class:"col"},re=(0,s._)("label",{for:"category",class:"form-label fw-semibold"},"分類*",-1),de={class:"col"},ce=(0,s._)("label",{for:"unit",class:"form-label fw-semibold"},"單位*",-1),ne={class:"mb-4"},ue={class:"row"},pe={class:"col"},me=(0,s._)("label",{for:"origin_price",class:"form-label fw-semibold"},"原價*",-1),he={class:"col"},ge=(0,s._)("label",{for:"price",class:"form-label fw-semibold"},"售價*",-1),_e=(0,s._)("hr",null,null,-1),be={class:"mb-3"},fe=(0,s._)("label",{for:"description",class:"form-label fw-semibold"},"產品描述",-1),we={class:"mb-3"},ye=(0,s._)("label",{for:"content",class:"form-label fw-semibold"},"說明內容",-1),ve={class:"form-check mb-3"},Ue=["checked"],xe=(0,s._)("label",{for:"is_enabled",class:"form-check-label fw-semibold"},"是否啟用*",-1),ke=(0,s._)("hr",null,null,-1),Me={class:"modal-footer"};function $e(e,t,l,a,i,r){const d=(0,s.up)("LoadingVue");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(d,{active:i.isLoading,style:{"z-index":"1056"}},null,8,["active"]),(0,s._)("div",f,[(0,s._)("div",w,[(0,s._)("div",y,[(0,s._)("div",v,[(0,s._)("h1",U,(0,o.zw)(i.product.id?"編輯產品":"新增產品"),1),(0,s._)("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=(...e)=>r.hideModal&&r.hideModal(...e))})]),(0,s._)("div",x,[(0,s._)("div",k,[(0,s._)("div",M,[(0,s._)("div",$,[P,i.product.imageUrl?((0,s.wg)(),(0,s.iD)("div",C,[(0,s._)("img",{src:i.product.imageUrl,alt:i.product.title,class:"img-fluid mb-2"},null,8,D),(0,s._)("div",L,[(0,s.wy)((0,s._)("input",{type:"text",class:"form-control imagesList","onUpdate:modelValue":t[1]||(t[1]=e=>i.product.imageUrl=e)},null,512),[[b.nr,i.product.imageUrl]]),(0,s._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[2]||(t[2]=e=>i.product.imageUrl="")}," 重新上傳 ")])])):((0,s.wg)(),(0,s.iD)("div",F,[(0,s._)("div",V,[z,(0,s.wy)((0,s._)("input",{type:"text",name:"imageUrl",id:"imageUrl",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":t[3]||(t[3]=e=>i.product.imageUrl=e)},null,512),[[b.nr,i.product.imageUrl]])]),(0,s._)("div",I,[j,(0,s._)("input",{type:"file",name:"imageFile",id:"imageFile",class:"form-control",ref:"imageFile_main",onChange:t[4]||(t[4]=e=>r.uploadFile(!0))},null,544)])]))]),q,((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(i.product.imagesUrl,((e,t)=>((0,s.wg)(),(0,s.iD)("div",{key:"url"+t},[(0,s._)("p",W,"產品其他圖片 - "+(0,o.zw)(t+1),1),e?((0,s.wg)(),(0,s.iD)("div",H,[(0,s._)("img",{src:e,alt:`${i.product.title}-其他圖片${t+1}`,class:"img-fluid mb-2"},null,8,S),(0,s._)("div",Y,[(0,s._)("button",{type:"button",class:"btn btn-outline-danger",onClick:e=>r.deleteImage(t)}," 刪除欄位 ",8,Z),(0,s.wy)((0,s._)("input",{type:"text",class:"form-control imagesList","onUpdate:modelValue":e=>i.product.imagesUrl[t]=e},null,8,E),[[b.nr,i.product.imagesUrl[t]]]),(0,s._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:e=>i.product.imagesUrl[t]=""}," 重新上傳 ",8,J)])])):((0,s.wg)(),(0,s.iD)("div",K,[(0,s._)("div",N,[(0,s._)("label",{for:`imageUrl_${t}`,class:"form-label"},"輸入圖片網址",8,O),(0,s.wy)((0,s._)("input",{type:"text",name:`imageUrl_${t}`,id:`imageUrl_${t}`,class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e=>i.product.imagesUrl[t]=e},null,8,B),[[b.nr,i.product.imagesUrl[t]]])]),(0,s._)("div",T,[(0,s._)("label",{for:`imageFile_${t}`,class:"form-label"},"上傳圖片",8,A),(0,s._)("input",{type:"file",name:`imageFile_${t}`,id:`imageFile_${t}`,class:"form-control",ref_for:!0,ref:"imageFile"+t,onChange:e=>r.uploadFile(!1,t)},null,40,G)]),(0,s._)("div",Q,[(0,s._)("button",{type:"button",class:"btn btn-outline-danger",onClick:e=>r.deleteImage(t)}," 刪除欄位 ",8,R)])])),X])))),128)),!i.product.imagesUrl||i.product.imagesUrl.length<5?((0,s.wg)(),(0,s.iD)("div",ee,[(0,s._)("button",{type:"button",class:"btn btn-outline-primary w-100",onClick:t[5]||(t[5]=e=>i.product.imagesUrl.push(""))}," 新增圖片欄位 ")])):(0,s.kq)("",!0)]),(0,s._)("div",te,[(0,s._)("div",le,[se,(0,s.wy)((0,s._)("input",{type:"text",name:"title",id:"title",class:"form-control",placeholder:"請輸入產品標題","onUpdate:modelValue":t[6]||(t[6]=e=>i.product.title=e),required:""},null,512),[[b.nr,i.product.title]])]),(0,s._)("div",oe,[(0,s._)("div",ae,[(0,s._)("div",ie,[re,(0,s.wy)((0,s._)("input",{type:"text",name:"category",id:"category",class:"form-control",placeholder:"請輸入產品分類","onUpdate:modelValue":t[7]||(t[7]=e=>i.product.category=e),required:""},null,512),[[b.nr,i.product.category]])]),(0,s._)("div",de,[ce,(0,s.wy)((0,s._)("input",{type:"text",name:"unit",id:"unit",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":t[8]||(t[8]=e=>i.product.unit=e),required:""},null,512),[[b.nr,i.product.unit]])])])]),(0,s._)("div",ne,[(0,s._)("div",ue,[(0,s._)("div",pe,[me,(0,s.wy)((0,s._)("input",{type:"num",name:"origin_price",id:"origin_price",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":t[9]||(t[9]=e=>i.product.origin_price=e),required:""},null,512),[[b.nr,i.product.origin_price,void 0,{number:!0}]])]),(0,s._)("div",he,[ge,(0,s.wy)((0,s._)("input",{type:"num",name:"price",id:"price",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":t[10]||(t[10]=e=>i.product.price=e),required:""},null,512),[[b.nr,i.product.price,void 0,{number:!0}]])])])]),_e,(0,s._)("div",be,[fe,(0,s.wy)((0,s._)("textarea",{name:"description",id:"description",rows:"2",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":t[11]||(t[11]=e=>i.product.description=e)},null,512),[[b.nr,i.product.description]])]),(0,s._)("div",we,[ye,(0,s.wy)((0,s._)("textarea",{name:"content",id:"content",rows:"2",class:"form-control",placeholder:"請輸入產品說明內容","onUpdate:modelValue":t[12]||(t[12]=e=>i.product.content=e)},null,512),[[b.nr,i.product.content]])]),(0,s._)("div",ve,[(0,s.wy)((0,s._)("input",{type:"checkbox",name:"is_enabled",id:"is_enabled",class:"form-check-input active","onUpdate:modelValue":t[13]||(t[13]=e=>i.product.is_enabled=e),checked:1===i.product.is_enabled},null,8,Ue),[[b.e8,i.product.is_enabled]]),xe]),ke])])]),(0,s._)("div",Me,[(0,s._)("button",{type:"button",class:"btn btn-outline-gray",onClick:t[14]||(t[14]=(...e)=>r.hideModal&&r.hideModal(...e))}," 取消 "),(0,s._)("button",{type:"button",class:"btn btn-secondary",onClick:t[15]||(t[15]=(...e)=>r.updateProduct&&r.updateProduct(...e))},(0,o.zw)(i.product.id?"更新":"新增"),1)])])])],512)],64)}var Pe=l(7972),Ce=l.n(Pe),De={data(){return{modal:{},product:{},isLoading:!1}},props:["tempProduct"],emits:["updateProduct","createProduct"],inject:["emitter"],watch:{tempProduct(){this.getData()}},methods:{showModal(){this.modal.show()},hideModal(){this.modal.hide(),this.getData()},getData(){this.product=JSON.parse(JSON.stringify(this.tempProduct)),this.product.imagesUrl||(this.product.imagesUrl=[])},updateProduct(){const e=this.checkFormatError().join("、");if(e)this.emitter.emit("sendMsg",{message:e,status:"error",title:"資料格式錯誤"});else{if(this.product.imagesUrl)for(let e=this.product.imagesUrl.length-1;e>-1;e--)""===this.product.imagesUrl[e]&&this.product.imagesUrl.splice(e,1);this.product.id?this.$emit("updateProduct",this.product):this.$emit("createProduct",this.product)}},checkFormatError(){const e=[];return this.product.title||e.push("標題欄位為必填"),this.product.category||e.push("分類欄位為必填"),this.product.unit||e.push("單位欄位為必填"),this.product.origin_price?"number"!==typeof this.product.origin_price&&e.push("原價欄位需填寫數字"):e.push("原價欄位為必填"),this.product.price?"number"!==typeof this.product.price&&e.push("售價欄位需填寫數字"):e.push("售價欄位為必填"),e},uploadFile(e,t=0){let l;this.isLoading=!0,l=e?this.$refs.imageFile_main.files[0]:this.$refs[`imageFile${t}`][0].files[0];const s=new FormData,o="https://vue3-course-api.hexschool.io/api/nn_macaron/admin/upload";s.append("file-to-upload",l),this.axios.post(o,s).then((s=>{this.isLoading=!1,s.data.success?(e?this.product.imageUrl=s.data.imageUrl:(this.product.imagesUrl||(this.product.imagesUrl=[]),this.product.imagesUrl[t]=s.data.imageUrl),l=void 0):alert(s.data.message.code||s.data.message)}))},deleteImage(e){this.product.imagesUrl.splice(e,1)}},mounted(){this.modal=new(Ce())(this.$refs.productModal,{backdrop:"static"})}},Le=l(89);const Fe=(0,Le.Z)(De,[["render",$e]]);var Ve=Fe,ze=l(81),Ie=l(6567),je={data(){return{products:[],temp:{},deleteProduct:{},isLoading:!1,pageInfo:{}}},components:{productModal:Ve,deleteModal:ze.Z,pagination:Ie.Z},inject:["emitter"],methods:{getData(e=1){this.isLoading=!0,window.scrollTo({top:0});const t=`https://vue3-course-api.hexschool.io/api/nn_macaron/admin/products?page=${e}`;this.axios.get(t).then((e=>{this.isLoading=!1,e.data.success?(this.products=e.data.products,this.pageInfo=e.data.pagination):alert(e.data.message)})).catch((e=>{alert(e)}))},editProduct(e={}){this.temp=e,this.$refs.productModal.showModal()},updateProduct(e){this.isLoading=!0;const t=`https://vue3-course-api.hexschool.io/api/nn_macaron/admin/product/${e.id}`;this.axios.put(t,{data:e}).then((t=>{this.isLoading=!1,t.data.success?(this.emitter.emit("sendMsg",{message:`已更新產品：${e.title}`,status:"success"}),this.$refs.productModal.hideModal(),this.getData()):this.emitter.emit("sendMsg",{message:t.data.message.join(", "),status:"error",title:"產品更新失敗"})})).catch((e=>{this.emitter.emit("sendMsg",{message:e,status:"error",title:"產品更新失敗"})}))},createProduct(e){this.isLoading=!0;const t="https://vue3-course-api.hexschool.io/api/nn_macaron/admin/product";this.axios.post(t,{data:e}).then((t=>{this.isLoading=!1,t.data.success?(this.emitter.emit("sendMsg",{message:`已新增產品：${e.title}`,status:"success"}),this.$refs.productModal.hideModal(),this.getData()):this.emitter.emit("sendMsg",{message:t.data.message.join(", "),status:"error",title:"產品新增失敗"})})).catch((e=>{this.emitter.emit("sendMsg",{message:e,status:"error",title:"產品新增失敗"})}))},deleteConfirm(e){this.deleteProduct=e,this.$refs.deleteModal.showModal()},deleteId(){this.isLoading=!0,this.$refs.deleteModal.hideModal();const e=`https://vue3-course-api.hexschool.io/api/nn_macaron/admin/product/${this.deleteProduct.id}`;this.axios.delete(e).then((e=>{this.isLoading=!1,e.data.success?this.emitter.emit("sendMsg",{message:`已刪除產品：${this.deleteProduct.title}`,status:"success"}):this.emitter.emit("sendMsg",{message:`${e.data.message}`,status:"error",title:"產品刪除失敗"}),this.getData(this.pageInfo.current_page)})).catch((e=>{this.emitter.emit("sendMsg",{message:`${e}`,status:"error",title:"產品刪除失敗"})}))}},created(){this.getData()}};const qe=(0,Le.Z)(je,[["render",_]]);var We=qe}}]);
//# sourceMappingURL=59.8caf0609.js.map