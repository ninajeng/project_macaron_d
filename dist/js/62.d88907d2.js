"use strict";(self["webpackChunkproject_macaron"]=self["webpackChunkproject_macaron"]||[]).push([[62],{5062:function(e,t,s){s.r(t),s.d(t,{default:function(){return pe}});var r=s(3396),l=s(7139);const d=(0,r._)("div",{class:"pt-4 py-3"},[(0,r._)("h2",{class:"m-0 text-secondary fw-bolder"},"訂單列表")],-1),a={class:"overflow-x-auto mb-3"},o={class:"table table-hover align-middle text-nowrap"},n=(0,r._)("thead",null,[(0,r._)("tr",null,[(0,r._)("th",null,"訂單日期"),(0,r._)("th",null,"訂單編號"),(0,r._)("th",null,"訂單狀態"),(0,r._)("th",null,"訂購人"),(0,r._)("th",null,"使用優惠券"),(0,r._)("th",{class:"text-end"},"訂單金額"),(0,r._)("th",{width:"250",class:"text-center"},"查看內容/刪除")])],-1),i={key:0},c={class:"text-end"},u={class:"text-center"},p={class:"btn-group btn-group-sm",role:"group","aria-label":"Basic example"},_=["onClick"],h=["onClick"];function m(e,t,s,m,g,b){const f=(0,r.up)("LoadingVue"),w=(0,r.up)("OrderModal"),x=(0,r.up)("deleteModal"),y=(0,r.up)("pagination");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r.Wm)(f,{active:g.isLoading,style:{"z-index":"1056"}},null,8,["active"]),(0,r.Wm)(w,{"temp-order":g.tempOrder,onUpdateOrder:b.updateOrder,ref:"orderModal"},null,8,["temp-order","onUpdateOrder"]),(0,r.Wm)(x,{ref:"deleteModal","delete-item":g.deleteOrder,item:"訂單",onDelete:b.deleteId},null,8,["delete-item","onDelete"]),d,(0,r._)("div",a,[(0,r._)("table",o,[n,g.orderList.length>0?((0,r.wg)(),(0,r.iD)("tbody",i,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(g.orderList,((t,s)=>((0,r.wg)(),(0,r.iD)("tr",{key:"order"+s},[(0,r._)("td",null,(0,l.zw)(this.$filters.unixToDate(t.create_at)),1),(0,r._)("td",null,(0,l.zw)(t.id),1),(0,r._)("td",{class:(0,l.C_)({"text-danger":!t.is_paid})},(0,l.zw)(t.is_paid?"訂單已完成":"尚未付款"),3),(0,r._)("td",null,(0,l.zw)(t.user.name),1),(0,r._)("td",null,(0,l.zw)(Object.values(t.products)[0].coupon?Object.values(t.products)[0].coupon.title:"無"),1),(0,r._)("td",c,(0,l.zw)(`$${e.$filters.currency(t.total)}`),1),(0,r._)("td",u,[(0,r._)("div",p,[(0,r._)("button",{type:"button",class:"btn btn-outline-success",onClick:e=>b.editOrder(t)}," 查看內容 ",8,_),(0,r._)("button",{type:"button",class:"btn btn-outline-danger",onClick:e=>b.deleteConfirm(t)}," 刪除 ",8,h)])])])))),128))])):(0,r.kq)("",!0)])]),(0,r.Wm)(y,{"page-info":g.pageInfo,onSetPage:b.getOrderList},null,8,["page-info","onSetPage"])],64)}const g={class:"modal fade",tabindex:"-1",ref:"orderModal"},b={class:"modal-dialog modal-lg modal-dialog-scrollable"},f={class:"modal-content"},w={class:"modal-header bg-secondary"},x=(0,r._)("h1",{class:"modal-title fs-5 text-white"},"訂單內容",-1),y={key:0,class:"modal-body text-nowrap"},v={class:"m-3 p-3 bg-secondary-subtle rounded overflow-x-auto"},O=(0,r._)("h5",{class:"fw-bolder text-secondary"},"訂單總覽",-1),$={class:"d-flex mb-1"},M={class:"me-5"},z={class:"mb-0 me-2 py-1"},k=(0,r._)("span",{class:"fw-bolder pe-3"},"訂單狀態",-1),I={class:"mb-2 mt-1"},L=(0,r._)("span",{class:"fw-bolder pe-3"},"訂單日期",-1),C={class:"mb-2"},D=(0,r._)("span",{class:"fw-bolder pe-3"},"訂單編號",-1),j={class:"d-flex"},S=(0,r._)("p",{class:"mb-0 py-1"},[(0,r._)("span",{class:"fw-bolder pe-3"},"修改狀態")],-1),W={class:"table border-dark mb-2"},q=(0,r._)("thead",null,[(0,r._)("tr",{class:"text-center"},[(0,r._)("th",null,"商品數量"),(0,r._)("th",null,"小計"),(0,r._)("th",null,"運費"),(0,r._)("th",null,"訂單優惠券"),(0,r._)("th",null,"優惠券折抵"),(0,r._)("th",null,"總計")])],-1),H={class:"text-center"},J=(0,r._)("td",null,"活動免運",-1),N={class:"m-3 p-3 bg-secondary-subtle rounded overflow-x-auto"},U=(0,r._)("h5",{class:"fw-bolder text-secondary"},"訂購品項",-1),Y={class:"table table-hover border-dark mb-2 text-center"},Z=(0,r._)("thead",null,[(0,r._)("tr",null,[(0,r._)("th",null,"品名"),(0,r._)("th",null,"產品代碼"),(0,r._)("th",null,"數量"),(0,r._)("th",null,"商品特價"),(0,r._)("th",{class:"text-end"},"單價"),(0,r._)("th",{class:"text-end"},"小計")])],-1),T={class:"text-end"},K={class:"text-end"},P={class:"m-3 p-3 bg-secondary-subtle rounded overflow-x-auto"},V=(0,r._)("h5",{class:"fw-bolder text-secondary"},"訂購人資料",-1),B={class:"d-md-flex"},A=(0,r._)("p",{class:"mb-0 fw-bolder pe-3 text-nowrap"},"配送方式",-1),E={class:"mb-2 text-wrap",style:{"text-align":"justify"}},F={class:"d-md-flex"},G=(0,r._)("p",{class:"mb-0 fw-bolder pe-3 text-nowrap"},"訂單備註",-1),Q={class:"mb-2 text-wrap",style:{"text-align":"justify"}},R={class:"table border-dark mb-2 text-center"},X=(0,r._)("thead",null,[(0,r._)("tr",null,[(0,r._)("th",null,"姓名"),(0,r._)("th",null,"連絡電話"),(0,r._)("th",null,"聯絡信箱")])],-1),ee={class:"modal-footer"};function te(e,t,s,d,a,o){const n=(0,r.up)("LoadingVue");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r.Wm)(n,{active:a.isLoading,style:{"z-index":"1056"}},null,8,["active"]),(0,r._)("div",g,[(0,r._)("div",b,[(0,r._)("div",f,[(0,r._)("div",w,[x,(0,r._)("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=(...e)=>o.hideModal&&o.hideModal(...e))})]),a.order.user?((0,r.wg)(),(0,r.iD)("div",y,[(0,r._)("div",v,[O,(0,r._)("div",$,[(0,r._)("div",M,[(0,r._)("p",z,[k,(0,r._)("span",{class:(0,l.C_)({"text-danger":!a.order.is_paid})},(0,l.zw)(a.order.is_paid?"訂單已完成":"尚未付款"),3)]),(0,r._)("p",I,[L,(0,r.Uk)((0,l.zw)(this.$filters.unixToDatetime(a.order.create_at)),1)]),(0,r._)("p",C,[D,(0,r.Uk)((0,l.zw)(a.order.id),1)])]),(0,r._)("div",j,[S,(0,r._)("button",{type:"button",class:(0,l.C_)(["btn btn-sm btn-success py-1 me-2 align-self-start",{disabled:a.order.is_paid}]),onClick:t[1]||(t[1]=t=>e.$emit("updateOrder",a.order))}," 已完成 ",2),(0,r._)("button",{type:"button",class:(0,l.C_)(["btn btn-sm btn-danger py-1 align-self-start",{disabled:!a.order.is_paid}]),onClick:t[2]||(t[2]=t=>e.$emit("updateOrder",a.order))}," 未完成 ",2)])]),(0,r._)("table",W,[q,(0,r._)("tbody",null,[(0,r._)("tr",H,[(0,r._)("td",null," 共 "+(0,l.zw)(a.orderItems.reduce(((e,t)=>e+t.qty),0))+" 件 ",1),(0,r._)("td",null,(0,l.zw)(`${e.$filters.currency(a.order.total+a.couponInfo.total)} 元`),1),J,(0,r._)("td",null,(0,l.zw)(a.couponInfo.title),1),(0,r._)("td",null,(0,l.zw)(`- ${e.$filters.currency(a.couponInfo.total)} 元`),1),(0,r._)("td",null,(0,l.zw)(`$ ${e.$filters.currency(a.order.total)} 元`),1)])])])]),(0,r._)("div",N,[U,(0,r._)("table",Y,[Z,(0,r._)("tbody",null,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(a.orderItems,((t,s)=>((0,r.wg)(),(0,r.iD)("tr",{key:"orderItems"+s},[(0,r._)("td",null,(0,l.zw)(t.product.title),1),(0,r._)("td",null,(0,l.zw)(t.product.id),1),(0,r._)("td",null,(0,l.zw)(t.qty),1),(0,r._)("td",null,(0,l.zw)(t.product.price===t.product.origin_price?"無":`${Math.floor(t.product.price/t.product.origin_price*10)}折`),1),(0,r._)("td",T,(0,l.zw)(e.$filters.currency(t.product.price)),1),(0,r._)("td",K,(0,l.zw)(e.$filters.currency(t.final_total)),1)])))),128))])])]),(0,r._)("div",P,[V,(0,r._)("div",B,[A,(0,r._)("p",E,(0,l.zw)(a.order.user.address),1)]),(0,r._)("div",F,[G,(0,r._)("p",Q,(0,l.zw)(a.order.message?a.order.message:"無"),1)]),(0,r._)("table",R,[X,(0,r._)("tbody",null,[(0,r._)("tr",null,[(0,r._)("td",null,(0,l.zw)(a.order.user.name),1),(0,r._)("td",null,(0,l.zw)(a.order.user.tel),1),(0,r._)("td",null,(0,l.zw)(a.order.user.email),1)])])])])])):(0,r.kq)("",!0),(0,r._)("div",ee,[(0,r._)("button",{type:"button",class:"btn btn-secondary",onClick:t[3]||(t[3]=(...e)=>o.hideModal&&o.hideModal(...e))}," 關閉 ")])])])],512)],64)}var se=s(7972),re=s.n(se),le={data(){return{modal:{},order:{},orderItems:[],couponInfo:{total:"",title:""},isLoading:!1}},props:["tempOrder"],emits:["updateOrder"],watch:{tempOrder(){this.getData()}},methods:{showModal(){this.modal.show()},hideModal(){this.modal.hide(),this.getData()},getData(){this.order=JSON.parse(JSON.stringify(this.tempOrder)),this.orderItems=Object.values(this.order.products),this.orderItems[0].coupon?(this.couponInfo.total=this.order.total/(this.orderItems[0].coupon.percent/100)-this.order.total,this.couponInfo.title=`${this.orderItems[0].coupon.code} ${this.orderItems[0].coupon.title}`):(this.couponInfo.total=0,this.couponInfo.title="無")}},mounted(){this.modal=new(re())(this.$refs.orderModal,{backdrop:"static"})}},de=s(89);const ae=(0,de.Z)(le,[["render",te]]);var oe=ae,ne=s(81),ie=s(6567),ce={data(){return{orderList:[],tempOrder:{},deleteOrder:{},isLoading:!1,pageInfo:{}}},components:{OrderModal:oe,deleteModal:ne.Z,pagination:ie.Z},inject:["emitter"],methods:{getOrderList(e=1){this.isLoading=!0,window.scrollTo({top:0});const t=`https://vue3-course-api.hexschool.io/api/nn_macaron/admin/orders?page=${e}`;this.axios.get(t).then((e=>{this.isLoading=!1,e.data.success?(this.orderList=e.data.orders,this.pageInfo=e.data.pagination):this.emitter.emit("sendMsg",{message:`訂單讀取失敗：${e.data.message}`,status:"error"})})).catch((e=>{this.emitter.emit("sendMsg",{message:`訂單讀取失敗：${e}`,status:"error"})}))},deleteConfirm(e){this.deleteOrder=e,this.$refs.deleteModal.showModal()},editOrder(e){this.tempOrder=e,this.$refs.orderModal.showModal()},deleteId(){this.isLoading=!0,this.$refs.deleteModal.hideModal();const e=`https://vue3-course-api.hexschool.io/api/nn_macaron/admin/order/${this.deleteOrder.id}`;this.axios.delete(e).then((e=>{this.isLoading=!1,e.data.success?(this.emitter.emit("sendMsg",{message:"訂單已刪除",status:"success"}),this.getOrderList(this.pageInfo.current_page)):this.emitter.emit("sendMsg",{message:`訂單刪除失敗：${e.data.message}`,status:"error"})})).catch((e=>{this.emitter.emit("sendMsg",{message:`訂單刪除失敗：${e}`,status:"error"})}))},updateOrder(e){const t=JSON.parse(JSON.stringify(e));t.is_paid=!t.is_paid;const s=`https://vue3-course-api.hexschool.io/api/nn_macaron/admin/order/${t.id}`;this.axios.put(s,{data:t}).then((e=>{this.isLoading=!1,e.data.success?(this.emitter.emit("sendMsg",{message:"已更新訂單資訊",status:"success"}),this.tempOrder=t,this.getOrderList(this.pageInfo.current_page)):this.emitter.emit("sendMsg",{message:`訂單更新失敗：${e.data.message}`,status:"error"})})).catch((e=>{this.emitter.emit("sendMsg",{message:`訂單更新失敗：${e}`,status:"error"})}))}},created(){this.getOrderList()}};const ue=(0,de.Z)(ce,[["render",m]]);var pe=ue}}]);
//# sourceMappingURL=62.d88907d2.js.map